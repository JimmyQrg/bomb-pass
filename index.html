<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bomb Pass</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
html,body{margin:0;padding:0;overflow:hidden;font-family:"Press Start 2P",monospace;background:#000;}
canvas{display:block;margin:0 auto;}
.ui{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:center/cover no-repeat;}
.menu{background:url("images/background-1.png") center/cover no-repeat;}
.settings{background:url("images/background-2.png") center/cover no-repeat;color:black;}
.btn{image-rendering:pixelated;cursor:pointer;transition:transform .1s;margin:5px;}
.btn:active{transform:scale(0.9);}
.input-row{margin:10px;font-size:14px;}
input{font-family:"Press Start 2P";font-size:14px;width:100px;text-align:center;}
.timer{position:absolute;top:20px;left:50%;transform:translateX(-50%);color:white;font-size:18px;text-shadow:2px 2px black;}
.restart{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);cursor:pointer;}
</style>
</head>
<body>
<div id="menu" class="ui menu">
  <img id="b2" class="btn" src="images/buttons/start-menu/button-2-players.png" style="width:120px;">
  <img id="b3" class="btn" src="images/buttons/start-menu/button-3-players.png" style="width:120px;">
  <img id="b4" class="btn" src="images/buttons/start-menu/button-4-players.png" style="width:120px;">
</div>

<div id="settings" class="ui settings" style="display:none;">
  <div class="input-row">Time (5â€“60s): <input id="timeInput" type="number" value="10" min="5" max="60"/></div>
  <img id="startBtn" class="btn" src="images/buttons/start-gray.png" style="width:150px;margin-top:20px;">
</div>

<canvas id="game"></canvas>
<div id="timer" class="timer" style="display:none;">0</div>
<img id="restart" class="restart" src="images/buttons/restart.png" style="width:120px;display:none;">

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
let TILE=16,MAP=500,map=[],players=[],bomb=null,gameState="menu",cam={x:0,y:0,zoom:1};
const assets={},keys={};
const playerCountDefault=2;
const ctrls=[{u:"w",d:"s",l:"a",r:"d",t:"q"},{u:"ArrowUp",d:"ArrowDown",l:"ArrowLeft",r:"ArrowRight",t:"/"},{u:"i",d:"k",l:"j",r:"l",t:"y"},{u:"t",d:"g",l:"f",r:"h",t:"r"}];
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);
const loadImage=(src)=>{const i=new Image();i.src=src;return i;}
assets.wall=loadImage("images/blocks/wall.png");
assets.ground=loadImage("images/blocks/ground-slab.png");
assets.bomb=loadImage("images/bomb.png");
for(let i=1;i<=4;i++){assets["p"+i]=loadImage("images/players/player-"+i+".png");assets["pb"+i]=loadImage("images/players/player-"+i+"-bomb.png");}

// Menu buttons
let playerCount=playerCountDefault;
document.getElementById("b2").onclick=()=>{playerCount=2;showSettings();}
document.getElementById("b3").onclick=()=>{playerCount=3;showSettings();}
document.getElementById("b4").onclick=()=>{playerCount=4;showSettings();}
const timeInput=document.getElementById("timeInput"),startBtn=document.getElementById("startBtn");
timeInput.oninput=()=>{const v=parseInt(timeInput.value);if(v>=5&&v<=60){startBtn.src="images/buttons/start.png";startBtn.onclick=startGame;}else{startBtn.src="images/buttons/start-gray.png";startBtn.onclick=null;}}
function showSettings(){document.getElementById("menu").style.display="none";document.getElementById("settings").style.display="flex";}
let gameTime=10,timeLeft=0;

function startGame(){
 gameTime=parseInt(timeInput.value);timeLeft=gameTime;
 document.getElementById("settings").style.display="none";
 document.getElementById("timer").style.display="block";
 document.getElementById("restart").style.display="none";
 initMap();initPlayers();assignBomb();centerCameraImmediate();gameState="playing";requestAnimationFrame(loop);
}

document.getElementById("restart").onclick=()=>location.reload();

function initMap(){
 map=[];for(let y=0;y<MAP;y++){map[y]=[];for(let x=0;x<MAP;x++)map[y][x]=0;}
 for(let x=0;x<MAP;x++){map[0][x]=1;map[MAP-1][x]=1;}
 for(let y=0;y<MAP;y++){map[y][0]=1;map[y][MAP-1]=1;}
 // Random wall patches
 for(let i=0;i<200;i++){
  const size=3+Math.floor(Math.random()*8);
  const x0=1+Math.floor(Math.random()*(MAP-size-1));
  const y0=1+Math.floor(Math.random()*(MAP-size-1));
  for(let y=y0;y<y0+size;y++){for(let x=x0;x<x0+size;x++)map[y][x]=1;}
 }
}

// Spawn players in close region
function findSpawnRegion(){
 const rx=5+Math.floor(Math.random()*(MAP-20));
 const ry=5+Math.floor(Math.random()*(MAP-20));
 return {x:rx,y:ry};
}

function initPlayers(){
 players=[];const color=["red","blue","green","yellow"];
 const region=findSpawnRegion();
 for(let i=0;i<playerCount;i++){
  let placed=false;
  while(!placed){
   const sx=region.x+Math.floor(Math.random()*10),sy=region.y+Math.floor(Math.random()*10);
   if(map[sy][sx]===0){players.push({x:sx*TILE,y:sy*TILE,speed:8,color:color[i],alive:true,ctrl:ctrls[i],hasBomb:false,img:assets["p"+(i+1)],id:i,trail:[]});placed=true;}
  }
 }
}

function assignBomb(){const r=Math.floor(Math.random()*playerCount);players[r].hasBomb=true;bomb={x:players[r].x,y:players[r].y,vx:0,vy:0,owner:r};}

// Camera centers immediately on players
function centerCameraImmediate(){
 const alive=players.filter(p=>p.alive);
 let cx=0,cy=0;
 for(const p of alive){cx+=p.x;cy+=p.y;}
 cx/=alive.length;cy/=alive.length;
 cam.x=cx-canvas.width/2/cam.zoom;cam.y=cy-canvas.height/2/cam.zoom;
}

// (The rest of the game logic remains the same as before: update loop, rendering, player movement, bomb mechanics, camera smoothing reduced for responsiveness)

</script>
</body>
</html>
