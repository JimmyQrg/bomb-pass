<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bomb Pass</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;font-family:"Press Start 2P",monospace;}
canvas{display:block;margin:0 auto;background:#000;}
.ui{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:url("images/background.png") center/cover no-repeat;}
.btn{image-rendering:pixelated;cursor:pointer;transition:transform .1s;}
.btn:active{transform:scale(0.9);}
.title{color:white;text-shadow:2px 2px black;font-size:24px;margin-bottom:40px;text-align:center;}
.input-row{color:white;margin:10px;font-size:12px;}
input{font-family:"Press Start 2P";font-size:12px;width:80px;text-align:center;}
.timer{position:absolute;top:20px;left:50%;transform:translateX(-50%);color:white;font-size:16px;text-shadow:2px 2px black;}
.restart{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);cursor:pointer;}
</style>
</head>
<body>
<div id="menu" class="ui">
  <div class="title">BOMB PASS</div>
  <img id="b2" class="btn" src="images/buttons/start.png" style="width:180px;margin:5px;">
  <img id="b3" class="btn" src="images/buttons/start.png" style="width:180px;margin:5px;">
  <img id="b4" class="btn" src="images/buttons/start.png" style="width:180px;margin:5px;">
</div>

<div id="settings" class="ui" style="display:none;">
  <div class="title">GAME SETTINGS</div>
  <div class="input-row">Time (5â€“60s): <input id="timeInput" type="number" value="10" min="5" max="60"/></div>
  <img id="startBtn" class="btn" src="images/buttons/start-gray.png" style="width:150px;margin-top:30px;">
</div>

<canvas id="game"></canvas>
<div id="timer" class="timer" style="display:none;">0</div>
<img id="restart" class="restart" src="images/buttons/restart.png" style="width:120px;display:none;">

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
let TILE=32,MAP=500,map=[],players=[],bomb=null,trail=[],gameState="menu",cam={x:0,y:0,zoom:1};
const assets={};const loadImage=(n)=>{const i=new Image();i.src=n;return i;};
assets.wall=loadImage("images/blocks/wall.png");
assets.ground=loadImage("images/blocks/ground-slab.png");
assets.bomb=loadImage("images/bomb.png");
for(let i=1;i<=4;i++){
 assets["p"+i]=loadImage("images/players/player-"+i+".png");
 assets["pb"+i]=loadImage("images/players/player-"+i+"-bomb.png");
}
const keys={};window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);
let playerCount=2,gameTime=10,timeLeft=0;
document.getElementById("b2").onclick=()=>{playerCount=2;showSettings();};
document.getElementById("b3").onclick=()=>{playerCount=3;showSettings();};
document.getElementById("b4").onclick=()=>{playerCount=4;showSettings();};
const timeInput=document.getElementById("timeInput"),startBtn=document.getElementById("startBtn");
timeInput.oninput=()=>{const v=parseInt(timeInput.value);
 if(v>=5&&v<=60){startBtn.src="images/buttons/start.png";startBtn.onclick=startGame;}
 else{startBtn.src="images/buttons/start-gray.png";startBtn.onclick=null;}
};
function showSettings(){document.getElementById("menu").style.display="none";document.getElementById("settings").style.display="flex";}
function startGame(){
 gameTime=parseInt(timeInput.value);timeLeft=gameTime;
 document.getElementById("settings").style.display="none";
 document.getElementById("timer").style.display="block";
 document.getElementById("restart").style.display="none";
 initMap();initPlayers();assignBomb();gameState="playing";requestAnimationFrame(loop);
}
document.getElementById("restart").onclick=()=>location.reload();

function initMap(){
 map=[];for(let y=0;y<MAP;y++){map[y]=[];
  for(let x=0;x<MAP;x++){map[y][x]=0;}
 }
 for(let i=0;i<30;i++){
  const w=5+Math.floor(Math.random()*295),x0=Math.floor(Math.random()*(MAP-w-2))+1;
  const y0=Math.floor(Math.random()*(MAP-w-2))+1;
  for(let y=y0;y<y0+w;y++){for(let x=x0;x<x0+w;x++){map[y][x]=1;}}
 }
 for(let x=0;x<MAP;x++){map[0][x]=1;map[MAP-1][x]=1;}
 for(let y=0;y<MAP;y++){map[y][0]=1;map[y][MAP-1]=1;}
}
function findSpawn(){
 while(true){
  const x=Math.floor(Math.random()*(MAP-10))+5;
  const y=Math.floor(Math.random()*(MAP-10))+5;
  if(map[y][x]==0)return {x,y};
 }
}
function initPlayers(){
 players=[];
 const color=["red","blue","green","yellow"];
 const ctrls=[
  {u:"w",d:"s",l:"a",r:"d",t:"q"},
  {u:"ArrowUp",d:"ArrowDown",l:"ArrowLeft",r:"ArrowRight",t:"/"},
  {u:"i",d:"k",l:"j",r:"l",t:"y"},
  {u:"t",d:"g",l:"f",r:"h",t:"r"}
 ];
 for(let i=0;i<playerCount;i++){
  const s=findSpawn();
  players.push({x:s.x*TILE,y:s.y*TILE,speed:3,color:color[i],alive:true,ctrl:ctrls[i],hasBomb:false,img:assets["p"+(i+1)],id:i});
 }
}

function assignBomb(){
 const r=Math.floor(Math.random()*playerCount);
 players[r].hasBomb=true;bomb={x:players[r].x,y:players[r].y,vx:0,vy:0,owner:r};
}

function drawMap(){
 const startX=Math.floor(cam.x/TILE),endX=Math.ceil((cam.x+canvas.width/cam.zoom)/TILE);
 const startY=Math.floor(cam.y/TILE),endY=Math.ceil((cam.y+canvas.height/cam.zoom)/TILE);
 for(let y=startY;y<=endY;y++){
  if(y<0||y>=MAP)continue;
  for(let x=startX;x<=endX;x++){
   if(x<0||x>=MAP)continue;
   const t=map[y][x];const img=t?assets.wall:assets.ground;
   ctx.drawImage(img,x*TILE,y*TILE,TILE,TILE);
  }
 }
}
function collide(x,y){
 const gx=Math.floor(x/TILE),gy=Math.floor(y/TILE);
 return map[gy]&&map[gy][gx]===1;
}

function loop(){
 if(gameState!=="playing")return;
 update();render();requestAnimationFrame(loop);
}

function update(){
 timeLeft-=1/60;if(timeLeft<=0){explode();}
 document.getElementById("timer").textContent=Math.ceil(timeLeft);
 const alive=players.filter(p=>p.alive);
 if(alive.length<=1){gameState="end";showWinner(alive[0]);return;}
 for(const p of players){
  if(!p.alive)continue;
  let dx=0,dy=0;
  if(keys[p.ctrl.u])dy-=p.speed;
  if(keys[p.ctrl.d])dy+=p.speed;
  if(keys[p.ctrl.l])dx-=p.speed;
  if(keys[p.ctrl.r])dx+=p.speed;
  const sp=p.hasBomb?p.speed*1.3:p.speed;
  if(!collide(p.x+dx*sp,p.y))p.x+=dx*sp;
  if(!collide(p.x,p.y+dy*sp))p.y+=dy*sp;
  if(keys[p.ctrl.t]&&p.hasBomb&&!bombThrowing){
   throwBomb(p);
  }
 }
 if(bomb&&bombThrowing){
  bomb.x+=bomb.vx;bomb.y+=bomb.vy;
  if(collide(bomb.x,bomb.y)){
   bomb.vx=bomb.vy=0;bombThrowing=false;
   const o=players[bomb.owner];o.hasBomb=true;
  }
  for(const p of players){
   if(!p.alive||p.id===bomb.owner)continue;
   if(Math.hypot(p.x-bomb.x,p.y-bomb.y)<TILE){
    players[bomb.owner].hasBomb=false;
    bomb.owner=p.id;bombThrowing=false;p.hasBomb=true;
    break;
   }
  }
 }
 updateCamera();
}

function updateCamera(){
 const alive=players.filter(p=>p.alive);
 if(alive.length==0)return;
 let minX=Infinity,maxX=-Infinity,minY=Infinity,maxY=-Infinity;
 for(const p of alive){minX=Math.min(minX,p.x);maxX=Math.max(maxX,p.x);minY=Math.min(minY,p.y);maxY=Math.max(maxY,p.y);}
 const cx=(minX+maxX)/2,cy=(minY+maxY)/2;
 cam.x+=(cx-cam.x)*0.05;cam.y+=(cy-cam.y)*0.05;
 const dist=Math.max(maxX-minX,maxY-minY);
 const targetZoom=Math.max(0.5,Math.min(2,800/(dist+400)));
 cam.zoom+=(targetZoom-cam.zoom)*0.05;
 const maxXpos=MAP*TILE-canvas.width/cam.zoom, maxYpos=MAP*TILE-canvas.height/cam.zoom;
 cam.x=Math.max(0,Math.min(cam.x,maxXpos));
 cam.y=Math.max(0,Math.min(cam.y,maxYpos));
}

let bombThrowing=false;
function throwBomb(p){
 bombThrowing=true;
 bomb.x=p.x;bomb.y=p.y;
 bomb.vx=(keys[p.ctrl.r]?1:keys[p.ctrl.l]?-1:0)*10;
 bomb.vy=(keys[p.ctrl.d]?1:keys[p.ctrl.u]?-1:0)*10;
 p.hasBomb=false;
}
function explode(){
 const h=players.find(p=>p.hasBomb);
 if(h)h.alive=false;
 bomb=null;
}
function showWinner(w){
 document.getElementById("restart").style.display="block";
}

function render(){
 ctx.save();ctx.scale(cam.zoom,cam.zoom);ctx.translate(-cam.x,-cam.y);
 drawMap();
 for(const p of players){
  if(!p.alive)continue;
  const img=p.hasBomb?assets["pb"+(p.id+1)]:assets["p"+(p.id+1)];
  ctx.drawImage(img,p.x-16,p.y-16,32,32);
 }
 if(bomb)ctx.drawImage(assets.bomb,bomb.x-16,bomb.y-16,32,32);
 ctx.restore();
}
</script>
</body>
</html>
